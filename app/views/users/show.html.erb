<% content_for :head do %>
  <%= javascript_tag do %>
    var TODAY = <%= Time.zone.now.to_i*1000 %>;
    var THIRTY_DAYS_AGO = <%= (Time.zone.now - 30.days).to_i*1000 %>;
    var by_day_user_tomatoes_path = '<%= by_day_user_tomatoes_url(@user, :format => :json) %>';
    var by_hour_user_tomatoes_path = '<%= by_hour_user_tomatoes_url(@user, :format => :json) %>';
  <% end %>
<% end %>

<% content_for :foot do %>
  <%= javascript_include_tag "user_charts.js" %>
  <%= javascript_include_tag "users.js" %>
<% end %>

<div id="user">
  <div class="block">
    <div class="profile left">
      <div class="block">
        <h2><%= user_name(@user) %></h2>
        <div class="left profile_image size48">
          <%= profile_image(@user, 48) %>
          <div class="overlay"></div>
        </div>
        <div class="left profile_info">
          Tomatoes: <%= @user.tomatoes.size %></br>
          <% @user.authorizations.each do |authorization| %>
            <%= link_to authorization.url, authorization.url %><br/>
          <% end %>
          <%= content_for_user(@user) do %>
            <div id="request_notification_permission">
              <%= link_to "", "#" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <%= content_for_user(@user) do %>
      <% ['twitter', 'github'].each do |provider| %>
        <%= render :partial => 'authorizations/authorization', :locals => {:provider => provider, :user => @user} %>
      <% end %>
    <% end %>
  </div>
  
  <%= content_for_user(@user) do %>
    <p>
      <%= link_to 'Your tomatoes', tomatoes_path %> |
      <%= link_to 'Export your tomatoes (csv)', tomatoes_path(format: :csv) %> |
      <%= link_to 'Edit profile', edit_user_path(@user) %>
    </p>
  <% end %>
</div>

<h2>Tomatoes by day</h2>
<div class="chart" id="tomatoes_by_day">
  <%= image_tag 'loading.gif', :class => 'loading' %>
</div>
<div class="chart overview" id="tomatoes_by_day_overview"></div>

<h2>Tomatoes by hour</h2>
<div class="chart" id="tomatoes_by_hour">
  <%= image_tag 'loading.gif', :class => 'loading' %>
</div>

<%= content_for_user(@user) do %>
  <h2>Tomatoes by tag</h2>
  <table>
    <thead>
      <tr>
        <th>Tag</th>
        <th>Tomatoes</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody>
      <% @user.tags.each do |array| %>
        <tr class="<%= cycle :even, :odd %>">
          <td><%= array[0] %></td>
          <td class="number"><%= array[1] %></td>
          <td class="time"><%= humanize(array[1]*Tomato::DURATION) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>